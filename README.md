# Мой топ-10 команд для очистки и оптимизации Docker-окружения

Этот файл содержит полезные команды для управления Docker-ресурсами, включая образы, контейнеры, сети и тома. Использование этих команд поможет поддерживать Docker в чистоте, освобождая дисковое пространство и оптимизируя окружение.

---

### 1. Удаление всех остановленных контейнеров

```bash
docker container prune -f
```

Удаляет все остановленные контейнеры, что помогает освободить место, не удаляя активные контейнеры.

### 2. Удаление всех ненужных образов (включая непомеченные):

```bash
docker image prune -a -f
```

Эта команда удаляет неиспользуемые образы, включая те, которые не связаны с контейнерами, освобождая значительный объем дискового пространства​

### 3. Удаление всех незакрепленных томов:

```bash
docker volume prune -f
```

Удаляет все неиспользуемые тома, сохраняя только те, которые все еще связаны с активными контейнерами​

### 4. Удаление всех неиспользуемых сетей:

```bash
docker network prune -f
```

Эта команда помогает очищать неиспользуемые сети, предотвращая их накопление.

#### Универсальная команда, которая удаляет все неиспользуемые контейнеры, образы, сети и тома сразу:

```bash
docker system prune -a -f --volumes
```

Полная очистка Docker-системы, включая все неиспользуемые объекты и тома. Используй с осторожностью, так как удаление томов удаляет и хранящиеся в них данные​

Ее можно использовать в скрипте вместо отдельных команд `prune` для каждого типа ресурсов, чтобы упростить процесс и избежать дублирования.

Однако раздельные команды позволяют гибко контролировать, какие именно объекты нужно удалять. Например, в некоторых случаях важно сохранить сети или тома, поэтому команды `docker network prune` или `docker volume prune` могут использоваться отдельно.

Если цель — полная очистка Docker-окружения без сохранения каких-либо неиспользуемых ресурсов, тогда `docker system prune -a -f --volumes` может заменить все отдельные команды в скрипте для простоты и эффективности.

### 5. Удаление отдельных логов контейнеров:

```bash
docker logs --tail 0 -f $(docker ps -q)
```

Если контейнеры активно пишут логи, можно периодически очищать их вручную. Включение логов с ограничением по размеру (например, `--log-opt max-size=10m --log-opt max-file=3`) при запуске контейнеров также помогает снизить нагрузку​

### 6. Удаление образов по фильтру времени создания:

```bash
docker image prune -a --filter "until=24h"
```

Удаляет все неиспользуемые образы, созданные более 24 часов назад, сохраняя недавно созданные.

### 7. Удаление контейнеров с фильтрацией по меткам:

```bash
docker container prune --filter "label!=keep"
```

Удаляет контейнеры, не имеющие определенной метки, что позволяет настроить выборочно очищаемые контейнеры​

### 8. Ограничение размера и числа файлов логов:

```bash
docker run --log-opt max-size=10m --log-opt max-file=3 mycontainer
```

Эта опция запуска контейнеров помогает контролировать использование диска для логов контейнера.

### 9. Проверка и удаление неиспользуемых файлов кэша сборки:

```bash
docker builder prune -f
```

Удаляет устаревший кэш, который накапливается при сборке образов.

### 10. Удаление конкретных образов по шаблону

```bash
docker images -a | grep "pattern" | awk '{print $3}' | xargs docker rmi
```

Используется для удаления образов, соответствующих определенному шаблону, например, устаревших версий приложения​
